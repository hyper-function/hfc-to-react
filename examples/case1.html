<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Hfc To React</title>
  </head>
  <body>
    <script type="importmap">
      {
        "imports": {
          "react": "https://esm.sh/react",
          "react-dom": "https://esm.sh/react-dom"
        }
      }
    </script>
    <script type="module">
      import React from "react";
      import ReactDom from "react-dom";
      import hfcToReact from "../dist/index.js";

      class HFC {
        static tag = "p";
        static propTypes = {
          attrs: { a: "1", b: "2", c: "3" },
          events: { ea: "1", eb: "2", ec: "3" },
          slots: { sa: "1", sb: "2", sc: "3" },
        };
        constructor(props) {
          this.props = props;
          console.log(props);
        }
        connected(container) {
          const btn = document.createElement("button");
          btn.innerText = "click me";
          btn.onclick = () => {
            this.props.events.eb();
          };

          const slot = document.createElement("p");
          let a = 0;
          setInterval(() => {
            a += 1;
            console.log(a);
            this.props.slots.sb(slot, { a });
          }, 2000);
          this.props.slots.sb(slot, { a });

          container.appendChild(btn);
          container.appendChild(slot);
        }
        changed(type, name, oldV, newV) {
          if (type === "attr") {
            console.log(`${name} changed from ${oldV} to ${newV}`);
            this.props.attrs[name] = newV;
          } else if (type === "event") {
            console.log(`${name} changed from ${oldV} to ${newV}`);
            this.props.events[name] = newV;
          } else if (type === "slot") {
            console.log(`${name} changed from ${oldV} to ${newV}`);
            this.props.slots[name] = newV;
          } else if (type === "other") {
            console.log(`${name} changed from ${oldV} to ${newV}`);
          }
        }
        disconnected() {
          console.log("disconnected");
        }
      }

      const Comp = hfcToReact(HFC);
      function App() {
        const [b, setB] = React.useState(0);
        React.useEffect(() => {
          setInterval(() => {
            setB((b) => b + 1);
          }, 2000);
        }, []);

        if (b > 2) {
          return React.createElement("div", {}, "over");
        }

        return React.createElement(Comp, {
          b,
          eb: () => {
            console.log("fire eb");
          },
          sb: (props) => {
            return React.createElement("h1", {}, "slot: " + props.a);
          },
          otot: 2,
          onclick: () => {
            console.log("esbebww");
          },
        });
      }

      const root = ReactDom.createRoot(document.body);
      root.render(React.createElement(App));
    </script>
  </body>
</html>
